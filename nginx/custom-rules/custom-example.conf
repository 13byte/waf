# Custom WAF Rules Example
# Created for demonstration purposes

# Block access to admin pages from external IPs
SecRule REQUEST_URI "@beginsWith /admin" \
    "id:100001,\
    phase:1,\
    block,\
    msg:'Admin access attempt from external IP',\
    severity:CRITICAL,\
    tag:'custom',\
    tag:'admin-protection',\
    setvar:tx.anomaly_score_pl1+=10"

# Block SQL injection attempts in custom parameters
SecRule ARGS:user_input "@detectSQLi" \
    "id:100002,\
    phase:2,\
    block,\
    msg:'SQL Injection attempt in user_input parameter',\
    severity:CRITICAL,\
    tag:'custom',\
    tag:'sqli-protection',\
    setvar:tx.anomaly_score_pl1+=10"

# Block suspicious user agents
SecRule REQUEST_HEADERS:User-Agent "@rx (nikto|nmap|nessus|metasploit)" \
    "id:100003,\
    phase:1,\
    block,\
    msg:'Suspicious scanner user agent detected',\
    severity:HIGH,\
    tag:'custom',\
    tag:'scanner-detection',\
    setvar:tx.anomaly_score_pl1+=5"

# Rate limiting for API endpoints
SecRule REQUEST_URI "@beginsWith /api/" \
    "id:100004,\
    phase:1,\
    pass,\
    msg:'API endpoint access',\
    tag:'custom',\
    tag:'api-monitoring',\
    setvar:ip.api_request_count=+1,\
    expirevar:ip.api_request_count=60"

# Block if too many API requests
SecRule IP:api_request_count "@gt 100" \
    "id:100005,\
    phase:1,\
    block,\
    msg:'API rate limit exceeded',\
    severity:MEDIUM,\
    tag:'custom',\
    tag:'rate-limiting',\
    setvar:tx.anomaly_score_pl1+=3"